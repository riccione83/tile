<div class= "container" style="margin-top:20px;">

<p id="notice"><%= notice %></p>

<div class="im-centered"> 
  
 <div class="row">
   <div class="col-md-6">
     
      <div id="carousel_<%=@work.id%>" class="carousel slide imageThumbWorkShow" data-ride="carousel">
        <!-- Wrapper for slides -->
        <div class="carousel-inner imageThumbWorkShow" role="listbox">
        <% @count = 0 %>  
        
        <% @work.pictures.each do |picture| %>  
          <% if @count == 0 %>
            <div class="item active imageThumbWorkShow">
          <% else %>
            <div class="item imageThumbWorkShow">
          <% end %>
                <img src="<%= picture.image.url %>" alt="..." class="imageThumbWorkShow">
                <div class="carousel-caption">
                </div>
            </div>
          <% @count += 1 %>
        <% end %>
        
        <% if @count == 0 %>  <!-- if no image was uploaded -->
         <div class="item active">
            <img src="../assets/idraulico.jpg" class="imageThumbWorkShow">
            <div class="carousel-caption">
            </div>
          </div>
        <% end %>
          
        </div>

        <!-- Controls -->
        <a class="left carousel-control imageThumbWorkShow" href="#carousel_<%=@work.id%>" role="button" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        
        <a class="right carousel-control imageThumbWorkShow" href="#carousel_<%=@work.id%>" role="button" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
  
      </div>
      <br>
    </div> <!-- md-9 -->
  
  <% @price = getCurrentPriceForWork(@work) %>
   <div class="col-md-3">
    <form method="post" action=<%=new_bid_path(@work)%> class="rcorners6">
      <% if @price.to_f == 0.0 %>
        <b>Fai un'offera per primo!</b><br>
      <% else %>
        <b>Fai un'offerta</b><br>(meno di <%= @price %>)<br>
      <% end %>
      <input type="text" name="new_price" class="form-control"><br>
      <input type="submit" name="submit" value="Invia i dati">
    </form>
  </div>

</div> <!-- ROW -->

</div> <!-- im-centered -->

<hr>

<p>
  <strong>From:</strong>
  <%= @work.user.email %>
</p>

<p>
  <strong>Titolo:</strong>
  <%= @work.title %>
</p>

<p>
  <strong>Description:</strong>
  <%= @work.description.html_safe %>
</p>

<p>
  <strong>Ultima offerta:</strong>
  <%= @price %>
</p>

<p>
  <strong>Location:</strong>
  <%= @work.location %>
</p>

<hr>

<div class= "form-signin text-center">
<%= link_to 'Segui', work_follow_path(@work) %> |
<% if current_user.id == @work.user_id %>
  <%= link_to 'Modifica', edit_work_path(@work) %> |
<% end %>
<%= link_to 'Indietro', works_path %>
</div>
<hr>

<h3>Ultime offerte</h3>
<table class="table table-responsive table-hover">
  <thead>
    <tr>
      <th>Utente</th>
      <th>Offerta</th>
      <th>Azioni</th>
    </tr>
  </thead>

  <tbody>
    <% @bids.each do |bid| %>
      <tr>
        <td><%= bid.user.email %></td>
        <% if bid.price == 0.0 %>
          <td>Sta seguendo</td>        
          <td></td>          
        <% else %>
          <td><%= bid.price %></td>
          <td><%= link_to 'Accetta questa offerta', payments_path(@work) %></td>          
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<hr>

<h3>Consigliati per te</h3>

<table class="table table-responsive table-hover">
  <thead>
    <tr>
      <th>Titolo</th>
      <th>Description</th>
      <th>Jaccard index</th>
    </tr>
  </thead>

  <tbody>
    <% @recomends.each do |_work| %>
     <% if _work.jaccard_index >= 0.08 %>
      <tr>
        <td><%= link_to _work.title, _work %> </td>
        <td><%=  truncateHTMLString(ActionView::Base.full_sanitizer.sanitize(_work.description),20).html_safe %></td>
        <td><%='%.2f' % _work.jaccard_index %></td>
      </tr>
     <% end %>
    <% end %>
  </tbody>
</table>

</div>